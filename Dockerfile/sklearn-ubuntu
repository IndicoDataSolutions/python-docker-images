FROM gcr.io/new-indico/numpy-ubuntu as numpy-base
FROM gcr.io/new-indico/scipy-ubuntu as scipy-base
FROM gcr.io/new-indico/pandas-ubuntu as pandas-base

FROM gcr.io/new-indico/ubuntu:18.04

COPY --from=numpy-base /root/.cache/pip/wheels/ /root/.cache/pip/wheels
COPY --from=pandas-base /root/.cache/pip/wheels/ /root/.cache/pip/wheels
COPY --from=scipy-base /root/.cache/pip/wheels/ /root/.cache/pip/wheels

ARG SKLEARN_VERSION=0.19.2

RUN apt-get install -y --no-install-recommends --no-install-suggests zlib1g-dev libjpeg-dev libpng-dev libfreetype-dev libopenblas-dev && \
    pip3 install Cython && \
    pip3 install numpy==1.15.4 && \
    pip3 install scipy==1.1.0 && \
    pip3 install pandas==0.23.4 && \
    pip3 install scikit-learn==${SKLEARN_VERSION} imbalanced-learn==0.3.3 && \
    pip3 install scikit-image==0.14.0
