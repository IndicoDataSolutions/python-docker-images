FROM gcr.io/new-indico/alpine:3.9.3

RUN apk update && \
    apk add --no-cache curl nodejs>12.18.3-r0 nodejs-npm>6.10.3-r2 nginx

ARG SASS_PATH="./node_modules/@indicodatasolutions/living-styleguide/styles"
ENV SASS_PATH=$SASS_PATH
ARG EXTEND_ESLINT=true
ENV EXTEND_ESLINT=$EXTEND_ESLINT
ARG NPM_TOKEN
ARG GITHUB_ACCESS_TOKEN
ARG INCLUDE_LOCAL_FILES="false"
ENV INCLUDE_LOCAL_FILES=$INCLUDE_LOCAL_FILES

RUN npm install -g yarn
RUN git clone https://${GITHUB_ACCESS_TOKEN}@github.com/IndicoDataSolutions/stratosphere.git && \
    cd stratosphere && \
    cp .npmrc $HOME/.npmrc && \
    yarn install
