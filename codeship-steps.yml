- type: parallel
  tag: "^(latest)$"
  steps:
    - name: Build
      type: push
      service: alpine-3-7-3
      registry: https://gcr.io
      image_name: gcr.io/new-indico/alpine
      image_tag: "3.7.3"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: alpine-3-9-3
      registry: https://gcr.io
      image_name: gcr.io/new-indico/alpine
      image_tag: "3.9.3"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: indicoio-alpine-3-7-3
      image_name: indicoio/alpine
      image_tag: "3.7.3"

    - name: Build
      type: push
      service: indicoio-alpine-3-9-3
      image_name: indicoio/alpine
      image_tag: "3.9.3"

    - name: Build
      type: push
      service: indicoio
      registry: https://gcr.io
      image_name: gcr.io/new-indico/indicoio
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: numpy
      registry: https://gcr.io
      image_name: gcr.io/new-indico/numpy
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: pandas
      registry: https://gcr.io
      image_name: gcr.io/new-indico/pandas
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: sklearn
      registry: https://gcr.io
      image_name: gcr.io/new-indico/sklearn
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: scipy
      registry: https://gcr.io
      image_name: gcr.io/new-indico/scipy
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: tsne
      registry: https://gcr.io
      image_name: gcr.io/new-indico/tsne
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: ubuntu_gpu
      registry: https://gcr.io
      image_name: gcr.io/new-indico/ubuntu_gpu
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: ubuntu-18-04
      registry: https://gcr.io
      image_name: gcr.io/new-indico/ubuntu
      image_tag: 18.04

    - name: Build
      type: push
      service: ubuntu
      registry: https://gcr.io
      image_name: gcr.io/new-indico/ubuntu
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: indicoio-ubuntu
      image_name: indicoio/ubuntu
      image_tag: "{{.Branch}}"
      encrypted_dockercfg_path: dockercfg.encrypted

    - name: Build
      type: push
      service: atmosphere
      registry: https://gcr.io
      image_name: gcr.io/new-indico/atmosphere
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg

    - name: Build
      type: push
      service: aws
      registry: https://gcr.io
      image_name: gcr.io/new-indico/aws
      image_tag: "{{.Branch}}"
      dockercfg_service: gcr-dockercfg
